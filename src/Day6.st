CLASS Day6 EXTENDS DayAbstract MODULE AocApp CLASSVARS ''
	VARS 'area position direction visitCount'

"Guards follow a very strict patrol protocol which involves repeatedly following these steps:
	- If there is something directly in front of you, turn right 90 degrees.
	- Otherwise, take a step forward.
 The guard leaves the area if there is no obstacle, which is the end."


title
	^ 'Day 6: Guard Gallivant'.
!
solve
	area := self area.
	position := self startPosition.
	direction := self startDirection.
	visitCount := 0.

	self markVisit.
	[ self step ] whileTrue: [ ].

	solution := visitCount.
	"self areaLog."
!
step
	| oldPosition |
	oldPosition := position.

	position := position + direction.
	self leftArea ifTrue: [ ^ false ].

	self occupance = $# ifTrue: [
		position := oldPosition.
		self turnRight.
		^ self step ].

	self markVisit.
	^ true.
!
leftArea
	^ ( position x < 0 ) | ( position x >= area first length ) |
		( position y < 0 ) | ( position y >= area length ).
!
turnRight
	direction :=
		direction x = 1
			ifTrue: [ 0 @ 1 ]
			ifFalse: [
				direction y = 1
					ifTrue: [ -1 @ 0 ]
					ifFalse: [
						direction x = -1
							ifTrue: [ 0 @ -1 ]
							ifFalse: [ 1 @ 0 ] ] ].
!
areaLog
	self log: 'Area:'.
	area do: [ :line |
		self log: line ].
!
occupance
	^ ( area at: position y ) at: position x.
!
markVisit
	self occupance = $. ifTrue: [
		( area at: position y ) at: position x put: $X.
		visitCount := visitCount + 1 ].
!
exampleArea
	^ #(
		'....#.....'
		'.........#'
		'..........'
		'..#.......'
		'.......#..'
		'..........'
		'.#........'
		'........#.'
		'#.........'
		'......#...'
	).
!
exampleStartPosition
	^ 4 @ 6.
!
exampleStartDirection
	^ 0 @ -1.
!
area
	^ #(
		'..........#....#..........#......#.......................#...#..........................................#.........................'
		'...................#.........#......#.....#.......................#......................#...#....................................'
		'...........#..#....................................................#..........................#................#......#...........'
		'.....#.#...........................................................................#..........#................#..................'
		'...#..........................................#...........................#....................#..#.........#.....................'
		'...........#.#...#..........#...............#..................#.............#...................................#............#...'
		'......................................................................................................................#..#......#.'
		'....................#..........#.........#.....#.......#....#........................................#..#..........#...........#..'
		'....................#......#...................................................#............................................#.....'
		'..................................................#.........................#...........................#...............#.........'
		'#....#....#..................#.........#..#...................#.........#....#.....#.#........................................#...'
		'...........................................#..............................................................#.......................'
		'#...............................................................................................#...............#...........##....'
		'...#......#.............#...............#.....#........................................#.#........#...........#...#...............'
		'#........#......#............................#.......................#............#...........................#...................'
		'............#................................................#....................................................#...............'
		'.......#.................#......................#.....................#..........#................................................'
		'.......................................................................................#.....#......#.............................'
		'...........................#..#....#.......................#.............................................#...#......#.............'
		'........#........##...#.....................................................#...........................................#.#.......'
		'...............................#.........#......................#...........#..........#.....#...........#.#.................#....'
		'..#.#.............#................................................................................#..................#...........'
		'.....................#.................#............................................#...................#...................#.#.#.'
		'........#...........................................................................................#............##...............'
		'........................................................#........................................................##...............'
		'..#........#.................#...............#......#..........................................#................#.................'
		'..................#......#.............................#.............................#.....................#...#........#........#'
		'....................................#.#.........#..#...............#...............#..............................................'
		'...##..................................................................#....#..............#.#...............................#....'
		'...........#....#...#........#..............................................#.......#.............................................'
		'.................................#.............................#...................................................#..............'
		'..........#.............................#.....#...............#..........................................##...............#.......'
		'...........................................#......##...............#..............#.............................#...#............#'
		'.#.#.....................#........#........................................................#..........#.........#.................'
		'.............#.......................................##..........#.#..........................................................#...'
		'.............#....................................................................................................................'
		'..................##.....#......#........................#......................#........#........................................'
		'.........................................................................................#.....#............#....................#'
		'.#...........#....................................#.#.....................................................#......#...#............'
		'#.#...#....................................................................................#............................##.......#'
		'...#...............#................#...#...#.......................#................................#.#....#.....................'
		'................................#........................................#...................#....................................'
		'...#..#.........#......#......................#..#.....................#..........................................................'
		'.................................................................#.......#........................................#...............'
		'..................................##.......................##........................................#............................'
		'....#....#.............#........................................................#....#.......#....................#..............#'
		'.........##.............................................................#..#.#.....#...........##.................................'
		'....#.........................................#......#.......................#....#..............................#...........#....'
		'.##.....#...........................#........#...................................................#....#...........................'
		'...........................................................#.....#.#...................#......................#......#............'
		'....#............#......................................................#.......#............................................#....'
		'#.......................#..........#.#............................#........#..................................................#...'
		'#....................#.....#......................................................#....................................#.....#....'
		'...#.....#.....#.................#...........#...............................................#....................................'
		'...........................#..........................#............#............#...........................................#.....'
		'.......#.....#..........#........#...................................................................................#........#...'
		'#.....................................#......................................#.............................#......#...............'
		'#.....#....................#.........................................................#................#...........................'
		'.........................................................#....#............#..##.....................#............................'
		'...#..............#.................................#.......#...................................................................#.'
		'............................#........#...........#.......................#.......................#..........#..........#..........'
		'....#..............#.............................................................................#.........#.....#...........#....'
		'..........#................#.........................................#.#..#......................................#...#............'
		'............#...............................................................................................#.#.......#......#..#.'
		'.#................................#...............#.........................#............................................#........'
		'....................................................#.......................#........#........................#.................#.'
		'..###...............#...............#..........................................#.............#...............#..#.#...............'
		'..#...#.......................................#...................................................................#...#...........'
		'..........#..........#..#......#.............................................#......#..................#...................#.....#'
		'.......#.....#.......#.......#.....................................................................................#..........#.#.'
		'#........................#..#......................................................#......#...........#................##.........'
		'....#.....................#...........................................................................#...........................'
		'.......................#..........................#.............................................................................#.'
		'.........#..............#...................#................#.........................#..........#...............................'
		'.........#...........................................................#................................................#......#....'
		'.................#.....#................#.............................................................#...................#......#'
		'....................#.....................................................#...................................................#...'
		'............##.................#...................#................#.......................................................#.....'
		'.........................#............#.#..........................................................................#........#.....'
		'............#.........#........................#..............................................##....#.......................#.....'
		'......#...................................................#..##.......................#...#.......................................'
		'............#.....................................................#..............#.##.....#...............................##......'
		'....................#...................#......#......#......................................................#.....#...#..........'
		'..........................................................................#....#..........#........#..............................'
		'.#.................................................#..............................................................................'
		'.......................#.............................................................#.....#..................#.................#.'
		'...#...............#.#................................#..............................#.....#..#.....#..........#...............#..'
		'...........................................#.............#................................................................#.......'
		'#..............#................................................................................................................#.'
		'..................................#.#................##..............#......#..................#......................#...........'
		'..........#...................................#..................................................#................#............#..'
		'....#.....................#......................#.....#.........#........#................#....#.................................'
		'................................................#......................#.....#....................................................'
		'......#.....#.........................#..........................................................................................#'
		'............................................#..............#.................................#......................#.............'
		'...#......#................................#...............#................................................#.....#...............'
		'#...............#.........................#.#..........................................................#......................#...'
		'..#........#......................#.........#............#...###.........#....................................................#...'
		'............#.....................#........................................#..............#.........#........#....................'
		'...#....#...........................................#.................#...............#.........................#.................'
		'......#........................#..................................................................................................'
		'...#..........................................#....................................................#...........#....##.#.........#'
		'....................#..........................#....#..#...........................................................#..............'
		'.....#...........#.........................#...............#..........................................#..#.#.....................#'
		'................#.......#......#.............................................................#...#................................'
		'...........#....#........##.....................#.....#.....#.....#.........................................................#.....'
		'.#.#.........................#...#......#................................#.......##......#..........#...#..........##.............'
		'...................#...................#......#............................................#...........#.......................#..'
		'..............#.#.................................#.....................................................................#.........'
		'......#............#...................................##....................................#...................#.#..............'
		'......................#.............................#....................................................#...............#........'
		'..........................#.......................................................................#.......##...#..................'
		'...................................................#..............#...#.............#.................#..........#.#....#.........'
		'...#......#....................#..................................................................#...............#......#........'
		'....#......#.#.........#..#..#......#.....................................................#.................#.....#...............'
		'......#..........#............#..............#.......#..................................#.........................................'
		'.##.#.........................#..#.............#..........#.........................................................#.............'
		'.....#..#......................##...........#........................#..#.............................................#...........'
		'.....#...............................#................#...........................................................................'
		'.##....#...................#............#....................................#..............##.............#................##....'
		'....................#......##..............................#...#.................#...............##...#............#..............'
		'.................#...........................#.....................................#.#........#...........#.........#....##.......'
		'......#.............................##....................#......................................................................#'
		'...........#........##...#......#...........#................#.....................................................#..............'
		'......#.#.................................#...........................................................#...#......#........#.#....#'
		'...........#......#....#...............#.......#................#.....................#...........................................'
		'....#......#............................##.#...............##.#..........#.........#........#.................................#...'
		'.#............................#................................#.#..............................................#.....#........#..'
		'.#.#.......#.......#.....................................................................#..............#.................##......'
		'.....#.......................................#.......#........#..............#.........#................#...#...#.................'
	).
!
startPosition
	^ 79 @ 80.
!
startDirection
	^ 0 @ -1.
!
